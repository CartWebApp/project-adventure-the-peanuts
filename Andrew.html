<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Pagan</title>
  <link rel="icon" href="images/icon.png">
  <link rel="stylesheet" href="Andrew.css" />
</head>
<body>
  <div id="container">
    <div id="scene"><div id="character">
      <img src="images/cardinal.png" alt="Character Sprite" id="character-sprite1">
      <img src="images/pope.png" alt="Character Sprite" id="character-sprite2">
      <img src="images/beggar.png" alt="Character Sprite" id="character-sprite3">
    </div></div>

    <div id="dialogue-bar">
      <p id="dialogue-text">Welcome, <span id="player-name">Player</span></p>
      <button id="next-btn">▶</button>
    </div>

    <!-- Choices Section -->
    <div id="choices" style="display: none;">
      <button id="choice-1"></button>
      <button id="choice-2"></button>
      <button id="choice-3" style="display: none;"></button>
    </div>
  </div>

  </div>
<script>
    let playerState = {
  liedToPope: false,
  sparedKnight: null
};
    const choicesDiv = document.getElementById("choices");
const choice1Btn = document.getElementById("choice-1");
const choice2Btn = document.getElementById("choice-2");
const choice3Btn = document.getElementById("choice-3");
    const dialogueLines = [
  "You walked out of the room, watching him watch you...",
  "You shut the door behind you, ready to leap like a scrappy pigeon.", 
  "But a voice had come to speak to you.",
  "“Excuse me, young believer.” You saw Cardinal Andrew look at you as he spoke his next words, “Shouldn't you be home?”",
   "__CHOICE_POINT_1__",
  "Cardinal Andrew looks like he was about to laugh or cringe.",
  "“Very funny,” he says, “But you shouldn't be joking, head home now as I deem so.” He waved you off gently before turning back to the rest of the holy men.",
  "As much as you wanted to ponder, you really needed to get home.",
  "You ran into the night, weaving through the eerie streets to the outskirts of the city...",
  "You could almost taste home...",
  "You stumbled on your feet.",
  "There, your parents' home stood before you like a parent inviting their open arms at you.",
  "You quickly brushed your clothes neatly and entered inside the home with haste.",
  "“There you are darling,” your mother says with a smile upon your arrival. Then your father reaches out to ruffle your hair and he speaks, “There you are, my child.”",
    "__CHOICE_POINT_2__",
    "Head to your room, okay? Must've been a long day,” your parents smiled kindly at you that you couldn't really be angry at them.",
    "You went inside your room, it was a humble room; only a bed, a shrine, a few books, and a few wooden toys crafted by your grandparents.",
    "__CHOICE_POINT_3__  (choose an etheral voice, choose a scary voice, choose to ignore)",
    "You arose early in the morning, sneaking out of the room, you didn't want to wake up your parents and disturb their sleep.",
  "With the creak of the door, you escaped your parent's home and headed off into the outskirts.",
  "You found the church and you headed inside.",
  "Inside, you found the Pope standing there.",
  "“Young believer,” the Pope approached you and appraised you. “You have a task that is demanded of you. Find the the gossipers who damn me, hurry now.”",
  "“Go off now, I await.” The Pope left you alone and you decided to head outside, there was bounded to be something.",
  "You founded yourself inside some bedroom, it led to here...",
  "And him.",
  "__CHOICE_POINT_4__",
  "The man laughed at your reaction before he calmed down, looking serene and not looking like he tried to steal something.",
  "“I don't think this is your room either,” he says, “Relax, I wasn't going to do anything horrendous. I was just checking things out.”",
  "“What does checking 'things' out even mean?” You said wryly.",
  "Before any of you spoke again, there was a voice.",
  "“Checking  stuff out, you say?”",
  "Cardinal Andrew sighed and walked inside the room.",
  "“I...” you trailed off, watching the second-in-command of the Pope walk in.",
  "“Ain't what it looks like,” the thieving man said.",
  "“I don't care what it may look like,” Cardinal Andrew said before looking at you.",
  "“It's you,” Cardinal Andrew said before speaking up again, “Do you vouch for this man's innocence?”",
  "__CHOICE_POINT_5__ (agree/truth, or agree/lie)",
  "Cardinal Andrew nods at your answer before turning back to the mysterious man.",
  "“This young believer believes in your innocence, however, that doesn't give you permission to rummage as you please. Escort yourself out or I'll have the Templers.”",
  "“Whatever you say, sir,” the mysterious man said before walking pass you through the only door.",
  "You followed with, not wanting to face the disapointment of Cardinal Andrew",
  "But as you walked passed the door, you felt something in your pocket.",
  "A bible, and a letter with the name and sigil of Elizabeth Likena; “I know the truth, Cardinal Andrew, I'll help you ursurp the Pope.”",
  "You ran down the halls.",
  "You panted as you stopped at an empty sermon with the Pope standing there, like he was expecting you.",
  "“What do you have for me?” The Pope says.",
  "__CHOICE_POINT_6__ (tell the truth, or, lie)",
  "The Pope summons forth the Templer knights and said, “Have Cardinal Andrew down into the catacombs.”",
  "The Templers left and the Pope smiled at you.",
  "“You done yourself well,” the Pope praised, “Perhaps you are more useful than you look. I shall grant you the honors of the execution.”",
  "__CHOICE_POINT_7__ (no way, or, okay I will)",
  "“You think you have a choice?”",
  "Later, deep within the catacombs, the Pope walked you to the catacombs. Inside, Cardinal Andrew was locked inside there, pacing around a strained face.",
  "“Take this.” The Pope handed you a sword.",
  "“And kill him,” he whispered into your ear.",
  "The Pope watched you as you stepped forward to the Cardinal.",
  "Cardinal Andrew glared at you, not of anger, but of immense disapointment, like you brought shame instead of true anger.",
  "“I believed in you,” Cardinal Andrew said.",
  "As you contemplated, there was a THUD in the other corridors of the catacombs...",
  "And out walked out was that mystery man.",
  "“Can't believe it...” you hear him mutter to himself, “Damn winding corridors...”",
  "“Kill them!” You hear the Pope order you.",
  "__CHOICE_POINT_8__ (choose to kill Newman, or, Gwaine)",
  "After the death of one of the men, you hear something growl in the darkness.",
  "(which knight that didn't die) and you watched as a...demon crawled forward.",
  "“Ghaume,” the Pope whispered before slowly stepping forward, leaving you and the Templer dumbfounded.",
  "The Pope began to yell, “Come to me! Hear---”",
  "The Pope vanished, gone, into the mouth of the demon.",
  "Minigame: kill the demon Ghuame",
  "(if you were lying and killed) After the demon is killed, (the one who survived) says, “Just go, I have nothing to say to you.”",
  "(if you told the truths and expressed regret) After the demon is killed, (the templer knight who survived) says, “You tried your best to survived and make the best out of your circumstances, just go.”",
  "You ran out of there, toring off your stained robes and running off into the light of God to your parents home.",
  "You approached the doors...and it opened.",
  "(ending 1: heaven)",
  "(ending 2: hell)",
  "(ending 3: the pope wins)",
  ];

  let currentLine = 0;
  let charIndex = 0;
  let typing = false;
  const dialogueText = document.getElementById("dialogue-text");
  const nextBtn = document.getElementById("next-btn");
  let blinkTimeout;

  function typeLine(line) {
    typing = true;
    dialogueText.textContent = "";
    charIndex = 0;
    clearTimeout(blinkTimeout);
    nextBtn.classList.remove("blink");

    const interval = setInterval(() => {
      if (charIndex < line.length) {
        dialogueText.textContent += line.charAt(charIndex);
        charIndex++;
      } else {
        clearInterval(interval);
        typing = false;
        startBlinkTimer(); // start blinking countdown after typing finishes
      }
    }, 15);
  }
  const choices = {
  CHOICE_POINT_1: {
    text1: "Stay Silent",
    text2: "Snark",
    result1: "You stayed silent, Cardinal Andrew raised a brow at your peculiar behavior.",
    result2: "“Shouldn't you be back at home nursing lambs?”",
    callback1: () => { typeLine("You stayed silent, Cardinal Andrew raised a brow at your peculiar behavior.");  currentLine++; },
    callback2: () => { typeLine("“Shouldn't you be back at home nursing lambs?”"); currentLine++; }

  },
  CHOICE_POINT_2: { 
  text1: "You reassure your parents.",
  text2: "You avoid speaking",
  result1: "'Don't worry, mama and papa, I just...got a little bit lost.'",
  result2: "'I'm okay, just tired.'",
  callback1: () => { typeLine("'Don't worry, mama and papa, I just...got a little bit lost.'"); currentLine++; },
  callback2: () => { typeLine("'I'm okay, just tired.'"); currentLine++; }

},
CHOICE_POINT_3: {
    text1: "The Old Wise's voice",
    text2: "The Silver Snake's voice",
    text3: "Ignore them both",
    result1: "\"Do what it takes to protect them.\"",
    result2: "\"Do what it takes to protect yourself.\"",
    result3: "There was only silence, your thoughts, your parents, your dilemma.",
    callback1: () => { typeLine("Do what it takes to protect them."); currentLine++; },
    callback2: () => { typeLine("Do what it takes to protect yourself."); currentLine++; },
    callback3: () => { typeLine("You clutched your ears and focused on silence."); currentLine++; }

  },
CHOICE_POINT_4: {
  text1: "Curse at him",
  text2: "Inquire nicely",
  result1: "“What the hell are you doing here!?”",
  result2: "“Excuse me...” you muttered, “What are you doing here?”",
  callback1: () => { typeLine("You gave the figure back to the two and they looked pleased enough."); currentLine++; },
  callback2: () => { typeLine("'No way,' you said, before running out of the catacombs with the figure in hand."); currentLine++; }
},
CHOICE_POINT_5: {
  text1: "“He's innocent.”",
  text2: "“I don't know who he is, cardinal.”",
  result1: "“Is that so?” Cardinal Andrew looked at the mysterious man who scoffed.",
  result2: "“Is that so?” Cardinal Andrew looked at the mysterious man who tried to his smirk.",
  callback1: () => { typeLine("“Is that so?” Cardinal Andrew looked at the mysterious man who scoffed."); currentLine++; },
  callback2: () => { typeLine("“Is that so?” Cardinal Andrew looked at the mysterious man who tried to his smirk."); currentLine++; }
},
CHOICE_POINT_6: {
  text1: "You decided to tell the truth.",
  text2: "You decided to lie.",
  result1: "'I had found blashempy letters in Cardinal Andrew's room.'",
  result2: "'There was nothing--'",
  callback1: () => { typeLine("'I had found blashempy letters in Cardinal Andrew's room.'"); currentLine++; },
  callback2: () => { typeLine("'There was nothing--'"); currentLine++; }
},
CHOICE_POINT_7: {
  text1: "You refused",
  text2: "You comply",
  result1: "'I...' you stuttered, 'I won't do it, I can't do it.'",
  result2: "'I...' you muttered, '...I can do it.'",
  callback1: () => { typeLine("I...' you stuttered, 'I won't do it, I can't do it."); currentLine++; },
  callback2: () => { typeLine("I...' you muttered, '...I can do it."); currentLine++; }
},
// CHOICE_POINT_8: {
//   text1: "You refused",
//   text2: "You comply",
//   result1: "'I...' you stuttered, 'I won't do it, I can't do it.'",
//   result2: "'I...' you muttered, '...I can do it.'",
//   callback1: () => { typeLine("I...' you stuttered, 'I won't do it, I can't do it."); currentLine++; },
//   callback2: () => { typeLine("I...' you muttered, '...I can do it."); currentLine++; }
// },
};
function showChoice(text1, text2, callback1, callback2, text3 = null, callback3 = null) {
  choicesDiv.style.display = "block"; 
  choice1Btn.style.display = "inline-block";
  choice2Btn.style.display = "inline-block";
  choice3Btn.style.display = text3 ? "inline-block" : "none"; 

  choice1Btn.textContent = text1;
  choice2Btn.textContent = text2;

  choice1Btn.onclick = function () {
    choicesDiv.style.display = "none"; 
    callback1(); 
    setTimeout(showNextLine, 200); 
  };

  choice2Btn.onclick = function () {
    choicesDiv.style.display = "none";
    callback2();
    setTimeout(showNextLine, 200);
  };

  if (text3 && callback3) {
    choice3Btn.textContent = text3;
    choice3Btn.onclick = function () {
      choicesDiv.style.display = "none";
      callback3();
      setTimeout(showNextLine, 200);
    };
  }
}

function showNextLine() {
  if (typing) return;

  clearTimeout(blinkTimeout);
  nextBtn.classList.remove("blink");

  const line = dialogueLines[currentLine];
  updateSceneImage(currentLine);


  if (line.startsWith("__CHOICE_POINT_")) { 
    const key = line.replace(/__/g, ""); 
    const choice = choices[key]; 

    if (!choice) {
      console.error(`No choice found for ${key}`);
      currentLine++;
      showNextLine();
      return;
    }

    showChoice( 
      choice.text1, 
      choice.text2, 
      () => { typeLine(choice.result1); currentLine++; }, 
      () => { typeLine(choice.result2); currentLine++; }, 
      choice.text3, 
      () => { typeLine(choice.result3); currentLine++; }
    );

    return;
  }

  typeLine(line);
  currentLine++;
}

// Scene changes mapping based on specific dialogue lines
const sceneChangesByLine = {
  "You were forced back outside and Sir Gwaine watched you silently.": "images/outsideChurch.png",
  "You ran into the night, weaving through the eerie streets to the outskirts of the city...": "images/outside.png",
  "There, your parents' home stood before you like a parent inviting their open arms at you.": "images/outsidehome.png",
  "“There you are darling,” your mother says with a smile upon your arrival. Then your father reaches out to ruffle your hair and he speaks, “There you are, my child.”": "images/insidehome.png",
  "You went inside your room, it was a humble room; only a bed, a shrine, a few books, and a few wooden toys crafted by your grandparents.": "images/bedroom.png",
  "With the creak of the door, you escaped your parent's home and headed off into the outskirts.": "images/outskirts.png",
  "You found a shed in the outskirts, there were footprints and it seemed to be locked.": "images/shed.png",
  "“What are you doing?” You heard a gruff voice behind you.": "images/knightsAppear.png",
  "Returning back to the cathedral, you see the Pope waiting there after his grandoise sermons.": "images/insidechurch.png",
  "Later, deep within the catacombs, the Pope walked you to the catacombs. Inside, the two knights stayed locked inside there.": "images/catacombs.png",
  "After the death of one of the knights, you hear something growl in the darkness.": "images/demonScene.png",
  "You ran out of there, tearing off your stained robes and running off into the light of God to your parents' home.": "images/outsidelight.png"
};

// Function to update the background scene
function updateSceneImage(line) {
  const sceneDiv = document.getElementById("scene");

  // Check if the current line has a corresponding image in sceneChangesByLine
  if (sceneChangesByLine[line]) {
    sceneDiv.style.backgroundImage = `url('${sceneChangesByLine[line]}')`;
  }
}

// Modify the `showNextLine` function to call `updateSceneImage` correctly
function showNextLine() {
  if (typing) return;

  clearTimeout(blinkTimeout);
  nextBtn.classList.remove("blink");

  if (currentLine >= dialogueLines.length) {
    dialogueText.textContent = "But you? You burst through the doors.";
    nextBtn.disabled = true;
    setTimeout(() => {
      window.location.href = "refuse-the-call.html"; // Redirect after finishing dialogue
    }, 2000);
    return;
  }

 const line = dialogueLines[currentLine];
updateSceneImage(line);
updateCharacterVisibility(line);

  
  // Call updateSceneImage with the current line of dialogue
  updateSceneImage(line);

  if (line.startsWith("__CHOICE_POINT_")) { 
    const key = line.replace(/__/g, ""); 
    const choice = choices[key]; 

    if (!choice) {
      console.error(`No choice found for ${key}`);
      currentLine++;
      showNextLine();
      return;
    }

    showChoice( 
      choice.text1, 
      choice.text2, 
      () => { typeLine(choice.result1); currentLine++; }, 
      () => { typeLine(choice.result2); currentLine++; }, 
      choice.text3, 
      () => { typeLine(choice.result3); currentLine++; }
    );

    return;
  }
  

  typeLine(line);
  currentLine++;
}

const characterVisibilityByLine = {
  "The Pope looks down at you, seemingly surprised to find an eavesdropper.": ["character-sprite2", "character-sprite1"],
  "“What do you think, sire? Execute the vermin?”": ["character-sprite1", "character-sprite2"],
  "Looking back, you saw Sister Lily and Archbishop Harald.": ["character-sprite1", "character-sprite3"],
  "“Step away child,” Archbishop Harald said": ["character-sprite1", "character-sprite3"],
  "(either way) The Pope summons forth the Sister Lily and Archbishop Harald.": ["character-sprite1", "character-sprite2", "character-sprite3"],
  "The Pope vanished, gone, into the mouth of the demon.": ["character-sprite1", "character-sprite3"], // Pope gone
  // Add more lines as needed
};
function updateCharacterVisibility(line) {
  const characters = ["character-sprite1", "character-sprite2", "character-sprite3"];
  const visibleCharacters = characterVisibilityByLine[line] || [];

  characters.forEach(id => {
    const el = document.getElementById(id);
    if (visibleCharacters.includes(id)) {
      el.style.display = "block";
    } else {
      el.style.display = "none";
    }
  });
}



nextBtn.addEventListener("click", showNextLine);

document.addEventListener("click", function (e) {
  if (!e.target.closest("#next-btn")) {
    showNextLine();
  }
});


  showNextLine(); // show first line
</script>
</body>
</html>

